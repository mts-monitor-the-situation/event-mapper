services:
  # Event Mapper Service
  event-mapper:
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      PYTHONUNBUFFERED: "1"
    volumes:
      - type: bind
        source: ./config.yaml
        target: /service/config.yaml
        read_only: true
    networks:
      - mts
    depends_on:
      redis:
        condition: service_started
      mongodb:
        condition: service_started
    restart: unless-stopped

  # Redis Service
  redis:
   image: redis:latest
   ports:
     - published: 6379
       target: 6379
       protocol: tcp
   networks:
      - mts
   depends_on:
    - mongodb
   attach: false
   
  # MongoDB Service
  mongodb:
   image: mongo:latest
   ports:
     - published: 27017
       target: 27017
       protocol: tcp
   networks:
      - mts
   attach: false

networks:
  mts:
    driver: bridge